{% extends 'layout/menu.html' %}

{% block content %}
<h2>Dashboard de Movimientos</h2>

<!-- Formulario para seleccionar el tipo de movimiento -->
<form method="get" action="{% url 'dashboard' %}">
    <label for="tipo_movimiento">Filtrar por Tipo de Movimiento:</label>
    <select name="tipo_movimiento" id="tipo_movimiento">
        <option value="">Todos</option>
        {% for tipo in tipos_movimiento %}
        <option value="{{ tipo.id }}" {% if request.GET.tipo_movimiento == tipo.id|stringformat:"s" %}selected{% endif %}>
            {{ tipo.nombre }}
        </option>
        {% endfor %}
    </select>
    <button type="submit">Filtrar</button>
</form>

<!-- Tabla de movimientos -->
<table border="1">
    <thead>
        <tr>
            <th>ID del Alumno</th>
            <th>Nombre del Alumno</th>
            <th>Tipo de Movimiento</th>
            <th>ID del Curso</th>
            <th>Nombre del Curso</th>
            <th>ID del Proyecto</th>
            <th>Nombre del Proyecto</th>
            <th>Fecha</th>
            <th>IdMovT</th>
            <th>Acciones</th>
            
        </tr>
    </thead>
    <tbody>
        {% for movimiento in movimientos %}
        <tr>
            <td>{{ movimiento.alumno_id }}</td>
            <td>{{ movimiento.alumno_nombre }}</td>
            <td>{{ movimiento.tipo_movimiento }}</td>
            <td>{{ movimiento.curso_id }}</td>
            <td>{{ movimiento.curso_name }}</td>
            <td>{{ movimiento.proyecto_id }}</td>
            <td>{{ movimiento.proyecto_name }}</td>
            <td>{{ movimiento.fecha }}</td>
            <td>{{ movimiento.id }}</td>
            <td>
                <!-- BotÃ³n para agregar tarea si hay proyecto asociado -->
                {% if movimiento.proyecto_id %}
                <a href="{% url 'agregar_tarea' movimiento.alumno_id movimiento.curso_id movimiento.proyecto_id %}">Agregar Tarea</a>
                {% endif %}

                {% if movimiento.alumno_nombre %}
                <form action="{% url 'confirmar_eliminar_movimiento' movimiento.id %}" method="GET">
                    {% csrf_token %}
                    <button>Eliminar Mov</button>
                </form> 
                {% else %}
                <span> Eliminar </span>
                {% endif %}

                {% if movimiento.alumno_nombre %}
                <a href="{% url 'confirmar_eliminar_movimiento' movimiento.alumno_id %}">Ver actividad</a>
                {% else %}
                <span> Actividad </span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}